{% extends 'base.html' %}

{% load markdown_filters %}

{% block title %}{{ course.title }}{% endblock %}

{% block breadcrumb %}
<div class="container mt-3">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'users:dashboard' %}">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ course.title|truncatechars:40 }}</li>
        </ol>
    </nav>
</div>
{% endblock %}

{% block content %}
<!-- Enhanced Loading Overlay for Generating Courses -->
{% if course.status == 'generating_metadata' or course.status == 'generating_modules_metadata' or course.status == 'generating_module_1' %}
<div id="loadingOverlay" class="modern-loading-overlay">
    <!-- Animated Background Particles -->
    <div class="particles-container">
        <div class="particle particle-1"></div>
        <div class="particle particle-2"></div>
        <div class="particle particle-3"></div>
        <div class="particle particle-4"></div>
        <div class="particle particle-5"></div>
        <div class="particle particle-6"></div>
        <div class="particle particle-7"></div>
        <div class="particle particle-8"></div>
    </div>

    <!-- Animated Waves Background -->
    <div class="waves-container">
        <div class="wave wave-1"></div>
        <div class="wave wave-2"></div>
        <div class="wave wave-3"></div>
    </div>

    <div class="modern-loading-content">
        <!-- Central AI Animation -->
        <div class="ai-animation-container">
            <div class="ai-core">
                <div class="core-rings">
                    <div class="ring ring-1"></div>
                    <div class="ring ring-2"></div>
                    <div class="ring ring-3"></div>
                </div>
                <div class="ai-icon">
                    <svg viewBox="0 0 100 100" class="ai-brain-svg">
                        <defs>
                            <linearGradient id="brainGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#60a5fa;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="neuronGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f59e0b;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Main Brain Shape -->
                        <path d="M25,35 C25,25 35,20 45,25 C50,15 60,15 65,25 C75,20 85,25 85,35 C90,40 90,50 85,55 C90,60 90,70 85,75 C75,80 65,75 60,75 C55,85 45,85 40,75 C35,75 25,80 15,75 C10,70 10,60 15,55 C10,50 10,40 15,35 C20,30 25,35 25,35 Z" fill="url(#brainGradient)" class="brain-main"/>
                        
                        <!-- Brain Hemispheres Division -->
                        <path d="M50,25 Q50,35 50,45 Q50,55 50,65 Q50,75 50,80" stroke="rgba(255,255,255,0.3)" stroke-width="1.5" fill="none" class="brain-division"/>
                        
                        <!-- Left Hemisphere Details -->
                        <path d="M20,40 Q30,45 35,50 Q30,55 25,60" stroke="rgba(255,255,255,0.4)" stroke-width="1" fill="none" class="brain-fold-1"/>
                        <path d="M25,30 Q35,35 40,40 Q35,45 30,50" stroke="rgba(255,255,255,0.4)" stroke-width="1" fill="none" class="brain-fold-2"/>
                        
                        <!-- Right Hemisphere Details -->
                        <path d="M75,40 Q65,45 60,50 Q65,55 70,60" stroke="rgba(255,255,255,0.4)" stroke-width="1" fill="none" class="brain-fold-3"/>
                        <path d="M70,30 Q60,35 55,40 Q60,45 65,50" stroke="rgba(255,255,255,0.4)" stroke-width="1" fill="none" class="brain-fold-4"/>
                        
                        <!-- Neural Network Nodes -->
                        <circle cx="30" cy="45" r="2" fill="url(#neuronGradient)" class="neuron neuron-1"/>
                        <circle cx="45" cy="35" r="2" fill="url(#neuronGradient)" class="neuron neuron-2"/>
                        <circle cx="55" cy="35" r="2" fill="url(#neuronGradient)" class="neuron neuron-3"/>
                        <circle cx="70" cy="45" r="2" fill="url(#neuronGradient)" class="neuron neuron-4"/>
                        <circle cx="40" cy="55" r="2" fill="url(#neuronGradient)" class="neuron neuron-5"/>
                        <circle cx="60" cy="55" r="2" fill="url(#neuronGradient)" class="neuron neuron-6"/>
                        
                        <!-- Neural Connections -->
                        <line x1="30" y1="45" x2="45" y2="35" stroke="rgba(251,191,36,0.6)" stroke-width="1" class="neural-connection connection-1"/>
                        <line x1="45" y1="35" x2="55" y2="35" stroke="rgba(251,191,36,0.6)" stroke-width="1" class="neural-connection connection-2"/>
                        <line x1="55" y1="35" x2="70" y2="45" stroke="rgba(251,191,36,0.6)" stroke-width="1" class="neural-connection connection-3"/>
                        <line x1="30" y1="45" x2="40" y2="55" stroke="rgba(251,191,36,0.6)" stroke-width="1" class="neural-connection connection-4"/>
                        <line x1="70" y1="45" x2="60" y2="55" stroke="rgba(251,191,36,0.6)" stroke-width="1" class="neural-connection connection-5"/>
                        <line x1="40" y1="55" x2="60" y2="55" stroke="rgba(251,191,36,0.6)" stroke-width="1" class="neural-connection connection-6"/>
                        
                        <!-- Thought Bubbles -->
                        <circle cx="20" cy="25" r="3" fill="rgba(255,255,255,0.6)" class="thought-bubble bubble-1"/>
                        <circle cx="80" cy="25" r="2" fill="rgba(255,255,255,0.6)" class="thought-bubble bubble-2"/>
                        <circle cx="15" cy="70" r="2.5" fill="rgba(255,255,255,0.6)" class="thought-bubble bubble-3"/>
                        <circle cx="85" cy="70" r="2" fill="rgba(255,255,255,0.6)" class="thought-bubble bubble-4"/>
                    </svg>
                </div>
                <div class="processing-dots">
                    <div class="dot dot-1"></div>
                    <div class="dot dot-2"></div>
                    <div class="dot dot-3"></div>
                </div>
            </div>
        </div>

        <!-- Dynamic Title -->
        <h1 class="modern-loading-title">Generando tu curso con IA</h1>
        
        <!-- Status Message -->
        <p class="modern-loading-status" id="loadingMessage">
            {% if course.status == 'generating_metadata' %}
                Analizando tu tema y creando la estructura del curso...
            {% elif course.status == 'generating_modules_metadata' %}
                Diseñando los módulos y objetivos de aprendizaje...
            {% elif course.status == 'generating_module_1' %}
                Creando el contenido del primer módulo...
            {% endif %}
        </p>

        <!-- Enhanced Progress Bar -->
        <div class="modern-progress-container">
            <div class="progress-track">
                <div class="progress-fill" id="modernProgressBar">
                    <div class="progress-glow"></div>
                </div>
                <div class="progress-particles">
                    <div class="particle-flow particle-flow-1"></div>
                    <div class="particle-flow particle-flow-2"></div>
                    <div class="particle-flow particle-flow-3"></div>
                </div>
            </div>
            <div class="progress-percentage" id="progressText">0%</div>
        </div>

        <!-- Progress Steps -->
        <div class="modern-progress-steps">
            <div class="progress-step {% if course.status == 'generating_metadata' %}active{% elif course.status == 'generating_modules_metadata' or course.status == 'generating_module_1' %}completed{% endif %}">
                <div class="step-circle">
                    <span class="step-number">1</span>
                    <div class="step-pulse"></div>
                </div>
                <span class="step-label">Comenzando</span>
            </div>
            <div class="step-connector"></div>
            <div class="progress-step {% if course.status == 'generating_modules_metadata' %}active{% elif course.status == 'generating_module_1' %}completed{% endif %}">
                <div class="step-circle">
                    <span class="step-number">2</span>
                    <div class="step-pulse"></div>
                </div>
                <span class="step-label">Ya casi</span>
            </div>
            <div class="step-connector"></div>
            <div class="progress-step {% if course.status == 'generating_module_1' %}active{% endif %}">
                <div class="step-circle">
                    <span class="step-number">3</span>
                    <div class="step-pulse"></div>
                </div>
                <span class="step-label">Ajustando detalles</span>
            </div>
        </div>

        <!-- Rotating Learning Facts -->
        <div class="learning-facts-container">
            <div class="fact-icon">
                <i class="fas fa-lightbulb"></i>
            </div>
            <div class="rotating-facts" id="rotatingFacts">
                <div class="fact active">¿Sabías que aprender en intervalos cortos aumenta la retención de memoria?</div>
                <div class="fact">El cerebro humano puede procesar información visual 60,000 veces más rápido que el texto</div>
                <div class="fact">Las personas recuerdan el 65% de la información visual después de 3 días</div>
                <div class="fact">El aprendizaje activo mejora la comprensión hasta en un 90%</div>
                <div class="fact">Enseñar a otros es una de las mejores formas de consolidar el conocimiento</div>
                <div class="fact">El cerebro forma nuevas conexiones neurales cada vez que aprendes algo nuevo</div>
                <div class="fact">Los descansos durante el estudio mejoran la concentración y la productividad</div>
                <div class="fact">La curiosidad libera dopamina, facilitando el proceso de aprendizaje</div>
            </div>
        </div>

        <!-- Dashboard Suggestion -->
        <div class="dashboard-suggestion">
            <a href="{% url 'users:dashboard' %}" class="suggestion-link">
                <i class="fas fa-external-link-alt"></i>
                <span>Explora otros cursos en tu dashboard</span>
            </a>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <!-- Course Sidebar -->
    <div class="col-lg-3 mb-4">
        <div class="card">
            <div class="card-body">
                <h6 class="text-muted mb-2">Progreso del Curso</h6>
                {% if user_progress %}
                <div class="progress mb-2">
                    <div class="progress-bar bg-success" role="progress-bar" 
                         style="width: {{ user_progress.get_completion_percentage }}%">
                    </div>
                </div>
                <small class="text-muted">{{ user_progress.get_completion_percentage }}% completado</small>
                {% else %}
                <div class="progress mb-2">
                    <div class="progress-bar bg-secondary" role="progress-bar" style="width: 0%"></div>
                </div>
                <small class="text-muted">0% completado</small>
                {% endif %}
            </div>
        </div>
        
        <!-- Course Info -->
        <div class="card mt-4">
            <div class="card-body">
                <h6 class="text-muted mb-3">Información del Curso</h6>
                <div class="mb-2">
                    <small class="text-muted">Nivel:</small><br>
                    <span class="badge bg-secondary">{{ course.get_user_level_display }}</span>
                </div>
                <div class="mb-2">
                    <small class="text-muted">Módulos:</small><br>
                    <span class="fw-bold">{{ course.total_modules }}</span>
                </div>
                <div class="mb-2">
                    <small class="text-muted">Estado:</small><br>
                    <span class="badge bg-primary" id="courseStatusBadge">{{ course.get_status_display }}</span>
                </div>
                <div>
                    <small class="text-muted">Tamaño:</small><br>
                    <span class="text-success">{{ course.total_size_estimate|default:"~300KB" }}</span>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="card mt-4">
            <div class="card-body">
                <h6 class="text-muted mb-3">Acciones Rápidas</h6>
                <div class="d-grid gap-2">
                    {% if user_progress.current_module %}
                        <a href="{% url 'module_view' course_id=course.id module_id=user_progress.current_module.module_id %}" 
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-play me-2"></i>
                            Continuar
                        </a>
                    {% endif %}
                    {% if course.podcast_audio_url %}
                    <button class="btn btn-outline-primary btn-sm" onclick="openPodcastPlayer()">
                        <i class="fas fa-podcast me-2"></i>
                        Reproducir Podcast
                    </button>
                    {% endif %}
                    <a href="{% url 'users:dashboard' %}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-home me-2"></i>
                        Dashboard
                    </a>
                </div>
            </div>
        </div>
        <!-- User Prompt & Interests -->
        <div class="card mt-4">
            <div class="card-body">
                <h6 class="text-muted mb-3">
                    <i class="fas fa-lightbulb me-2"></i>
                    Prompt original del usuario
                </h6>

                <!-- Prompt elegant box -->
                <div class="bg-light border rounded p-3">
                    <p class="mb-0" style="white-space: pre-wrap;">{{ course.user_prompt|linebreaksbr }}</p>
                </div>

                <!-- User interests -->
                {% if course.user_interests %}
                <div class="mt-3">
                    <small class="text-muted">Intereses seleccionados:</small>
                    <div class="mt-1">
                        {% for interest in course.user_interests %}
                        <span class="badge bg-light text-dark border me-1">{{ interest }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="col-lg-9">
        <!-- Course Header -->
        <div class="card course-card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h1 class="card-title h2 mb-2">{{ course.title }}</h1>
                        <span class="badge bg-primary status-badge" id="mainStatusBadge">{{ course.get_status_display }}</span>
                        {% if course.status == 'complete' %}
                        <span class="badge bg-success ms-2">
                            <i class="fas fa-check me-1"></i>Completado
                        </span>
                        {% endif %}
                    </div>
                    <div class="text-end">
                        <small class="text-muted">ID: {{ course.course_id }}</small>
                        <br>
                        <small class="text-muted">{{ course.created_at|date:"d/m/Y H:i" }}</small>
                    </div>
                </div>
                
                <p class="card-text lead">{{ course.description }}</p>
            </div>
        </div>

        <!-- Course Introduction -->
        {% if course.introduction %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-play me-2"></i>
                    Introducción al Curso
                </h5>
            </div>
            <div class="card-body">
                <div class="chunk-content mb-4">
                    {{ course.introduction|markdownify }}
                </div>
                
                <!-- Botón Reproduce Intro -->
                <div class="text-center">
                    <button class="btn btn-success btn-lg" onclick="playIntroAudio()">
                        <i class="fas fa-play me-2"></i>
                        Reproduce Intro al Curso
                    </button>
                </div>
                
                <!-- Audio del podcast introductorio (oculto por defecto) -->
                <div id="intro-audio-container" class="mt-4" style="display: none;">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-podcast me-2"></i>Podcast Introductorio con María y Carlos</h6>
                        <p class="mb-3">Escucha esta introducción especial al curso donde María y Carlos te explican qué aprenderás.</p>
                        
                        {% if course.podcast_audio_url %}
                            <audio id="intro-audio" controls class="w-100 mb-3">
                                <source src="{{ course.podcast_audio_url }}" type="audio/mpeg">
                                Tu navegador no soporta el elemento de audio.
                            </audio>
                        {% else %}
                            <!-- Audio simulado si no hay URL real -->
                            <div class="audio-simulator p-3 border rounded mb-3">
                                <div class="d-flex align-items-center">
                                    <button id="play-pause-btn" class="btn btn-primary btn-sm me-3" onclick="toggleAudioSimulator()">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <div class="flex-grow-1">
                                        <div class="d-flex justify-content-between mb-1">
                                            <small>Podcast Introductorio</small>
                                            <small id="audio-time">0:00 / 2:30</small>
                                        </div>
                                        <div class="progress">
                                            <div id="audio-progress" class="progress-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if course.podcast_script %}
                        <details>
                            <summary class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-file-text me-1"></i>
                                Ver Transcripción
                            </summary>
                            <div class="mt-3 p-3 bg-light rounded">
                                <pre class="mb-0" style="white-space: pre-wrap; font-family: inherit;">{{ course.podcast_script }}</pre>
                            </div>
                        </details>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Course Modules -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-book-open me-2"></i>
                    Módulos del Curso
                </h5>
            </div>
            <div class="card-body">
                <div class="modules-container" id="modulesContainer">
                    {% if course.modules.all %}
                        <!-- Mostrar módulos completos cuando están disponibles -->
                        {% for module in course.modules.all %}
                        <div class="module-card border rounded p-4 mb-3 {% if user_progress.current_module.id == module.id %}border-primary{% endif %}">
                            <div class="row align-items-center">
                                <div class="col-lg-8">
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-primary rounded-pill me-3">{{ module.module_order }}</span>
                                        <h5 class="mb-0">{{ module.title }}</h5>
                                        {% if user_progress.current_module.id == module.id %}
                                        <span class="badge bg-warning ms-2">Actual</span>
                                        {% endif %}
                                    </div>
                                    <p class="text-muted mb-2">{{ module.description|truncatewords:20 }}</p>
                                    
                                    <!-- Module progress -->
                                    {% if user_progress %}
                                    <div class="module-progress">
                                        {% with module_chunks=module.chunks.all %}
                                        {% with completed_count=user_progress.completed_chunks|length %}
                                        <small class="text-muted">
                                            <i class="fas fa-file-text me-1"></i>
                                            {{ module_chunks|length }} partes
                                            {% if completed_count > 0 %}
                                                • {{ completed_count }} completadas
                                            {% endif %}
                                        </small>
                                        {% endwith %}
                                        {% endwith %}
                                    </div>
                                    
                                    {# Nueva barra de progreso por módulo #}
                                    {% with module_chunks=module.chunks.all %}
                                        {% if module_chunks %}
                                            {% with total_expected=module_chunks.0.total_chunks %}
                                                <div class="progress" style="height: 6px;">
                                                    <div class="progress-bar bg-primary" role="progress-bar" style="width: {% widthratio module_chunks|length total_expected 100 %}%;"></div>
                                                </div>
                                            {% endwith %}
                                        {% else %}
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar bg-secondary" role="progress-bar" style="width: 0%;"></div>
                                            </div>
                                        {% endif %}
                                    {% endwith %}
                                    {% endif %}
                                </div>
                                <div class="col-lg-4 text-lg-end">
                                    <a href="{% url 'module_view' course_id=course.id module_id=module.module_id %}" 
                                       class="btn btn-primary">
                                        <i class="fas fa-arrow-right me-2"></i>
                                        Estudiar Módulo
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Module concepts preview -->
                            {% if module.concepts %}
                            <div class="mt-3">
                                <small class="text-muted">Conceptos clave:</small>
                                <div class="mt-1">
                                    {% for concept in module.concepts|slice:":4" %}
                                    <span class="badge bg-light text-dark border me-1">{{ concept }}</span>
                                    {% endfor %}
                                    {% if module.concepts|length > 4 %}
                                    <span class="badge bg-light text-muted border">+{{ module.concepts|length|add:"-4" }} más</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% elif course.module_list %}
                        <!-- Mostrar preview de módulos cuando solo hay metadata -->
                        {% for module_title in course.module_list %}
                        <div class="module-card border rounded p-4 mb-3 border-info">
                            <div class="row align-items-center">
                                <div class="col-lg-8">
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-info rounded-pill me-3">{{ forloop.counter }}</span>
                                        <h5 class="mb-0">{{ module_title }}</h5>
                                        <span class="badge bg-info ms-2">
                                            {% if forloop.counter == 1 and course.status == 'generating_module_1' %}
                                                Generando...
                                            {% elif forloop.counter == 1 and course.status == 'ready' %}
                                                Listo
                                            {% else %}
                                                Pendiente
                                            {% endif %}
                                        </span>
                                    </div>
                                    <p class="text-muted mb-2">Contenido en proceso de generación...</p>
                                </div>
                                <div class="col-lg-4 text-lg-end">
                                    {% if forloop.counter == 1 and course.status == 'ready' %}
                                        <a href="{% url 'module_view' course_id=course.id module_id='modulo_1' %}" 
                                           class="btn btn-primary">
                                            <i class="fas fa-arrow-right me-2"></i>
                                            Estudiar Módulo
                                        </a>
                                    {% else %}
                                        <button class="btn btn-outline-secondary" disabled>
                                            <i class="fas fa-clock me-2"></i>
                                            {% if forloop.counter == 1 %}En progreso...{% else %}Próximamente{% endif %}
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <!-- Fallback cuando no hay información de módulos -->
                        <div class="text-center py-4">
                            <i class="fas fa-book fa-3x text-muted mb-3"></i>
                            <h6 class="text-muted">Módulos en preparación</h6>
                            <p class="text-muted mb-0">La estructura del curso se está generando...</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Final Project -->
        {% if course.final_project_data %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-trophy me-2"></i>
                    Proyecto Final
                </h5>
            </div>
            <div class="card-body">
                {% if course.final_project_data.title %}
                    <h6>{{ course.final_project_data.title }}</h6>
                {% endif %}
                {% if course.final_project_data.description %}
                    <p>{{ course.final_project_data.description }}</p>
                {% endif %}
                {% if course.final_project_data.objectives %}
                    <h6 class="mt-3">Objetivos:</h6>
                    <ul>
                        {% for objective in course.final_project_data.objectives %}
                        <li>{{ objective }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% if course.final_project_data.deliverables %}
                    <h6 class="mt-3">Entregables:</h6>
                    <ul>
                        {% for deliverable in course.final_project_data.deliverables %}
                        <li>{{ deliverable }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Prerequisites -->
        {% if course.prerequisites %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list-check me-2"></i>
                    Prerrequisitos
                </h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% for prerequisite in course.prerequisites %}
                    <li class="list-group-item">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        {{ prerequisite }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Success Notification Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <div class="success-animation mb-4">
                    <div class="checkmark">
                        <div class="checkmark-stem"></div>
                        <div class="checkmark-kick"></div>
                    </div>
                </div>
                <h4 class="fw-bold text-success mb-3">¡Curso Listo!</h4>
                <p class="text-muted mb-4">Tu curso ha sido generado exitosamente. Ya puedes empezar a aprender.</p>
                <button type="button" class="btn btn-success btn-lg" data-bs-dismiss="modal">
                    <i class="fas fa-rocket me-2"></i>
                    ¡Empezar a Aprender!
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Course status polling
let pollingInterval;
const courseId = '{{ course.id }}';
const currentStatus = '{{ course.status }}';

// Start polling if course is generating
if (['generating_metadata', 'generating_modules_metadata', 'generating_module_1'].includes(currentStatus)) {
    startPolling();
}

function startPolling() {
    pollingInterval = setInterval(checkCourseStatus, 3000); // Check every 3 seconds
}

function checkCourseStatus() {
    fetch(`/course/${courseId}/status/`)
        .then(response => response.json())
        .then(data => {
            if (data.status !== currentStatus) {
                // Status changed, reload page to show new content
                showSuccessNotification();
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            }
        })
        .catch(error => {
            console.error('Error checking course status:', error);
        });
}

function showSuccessNotification() {
    // Stop polling
    if (pollingInterval) {
        clearInterval(pollingInterval);
    }
    
    // Hide loading overlay
    const overlay = document.getElementById('loadingOverlay');
    if (overlay) {
        overlay.style.opacity = '0';
        setTimeout(() => {
            overlay.style.display = 'none';
        }, 500);
    }
    
    // Show success modal
    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
    successModal.show();
}

// Enhanced progress bar animation
function animateModernProgressBar() {
    const progressBar = document.getElementById('modernProgressBar');
    const progressText = document.getElementById('progressText');
    if (progressBar && progressText) {
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 8 + 2; // Slower, more realistic progress
            if (progress > 90) progress = 90;
            
            progressBar.style.width = progress + '%';
            progressText.textContent = Math.round(progress) + '%';
            
            if (progress >= 90) {
                clearInterval(interval);
            }
        }, 1500);
    }
}

// Rotating learning facts
function startFactRotation() {
    const facts = document.querySelectorAll('.fact');
    if (facts.length === 0) return;
    
    let currentIndex = 0;
    
    setInterval(() => {
        // Remove active class from current fact
        facts[currentIndex].classList.remove('active');
        
        // Move to next fact
        currentIndex = (currentIndex + 1) % facts.length;
        
        // Add active class to new fact
        facts[currentIndex].classList.add('active');
    }, 4000); // Change every 4 seconds
}

// Initialize animations if loading overlay exists
if (document.getElementById('loadingOverlay')) {
    animateModernProgressBar();
    startFactRotation();
}

// Audio simulator functions
let audioSimulatorInterval;
let currentTime = 0;
const totalTime = 150; // 2:30 in seconds

function toggleAudioSimulator() {
    const btn = document.getElementById('play-pause-btn');
    const icon = btn.querySelector('i');
    const timeDisplay = document.getElementById('audio-time');
    const progressBar = document.getElementById('audio-progress');
    
    if (icon.classList.contains('fa-play')) {
        // Start playing
        icon.classList.remove('fa-play');
        icon.classList.add('fa-pause');
        
        audioSimulatorInterval = setInterval(() => {
            currentTime++;
            const minutes = Math.floor(currentTime / 60);
            const seconds = currentTime % 60;
            const totalMinutes = Math.floor(totalTime / 60);
            const totalSeconds = totalTime % 60;
            
            timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')} / ${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            progressBar.style.width = (currentTime / totalTime * 100) + '%';
            
            if (currentTime >= totalTime) {
                stopAudioSimulator();
            }
        }, 1000);
    } else {
        // Pause
        stopAudioSimulator();
    }
}

function stopAudioSimulator() {
    const btn = document.getElementById('play-pause-btn');
    const icon = btn.querySelector('i');
    
    icon.classList.remove('fa-pause');
    icon.classList.add('fa-play');
    
    if (audioSimulatorInterval) {
        clearInterval(audioSimulatorInterval);
    }
}

function playIntroAudio() {
    const container = document.getElementById('intro-audio-container');
    container.style.display = 'block';
    
    // Scroll to audio
    container.scrollIntoView({ behavior: 'smooth' });
    
    // Auto-play if real audio exists
    const audio = document.getElementById('intro-audio');
    if (audio) {
        setTimeout(() => {
            audio.play().catch(e => console.log('Auto-play prevented:', e));
        }, 500);
    }
}

function openPodcastPlayer() {
    // Create modal if it doesn't exist
    if (!document.getElementById('podcastModal')) {
        createPodcastModal();
    }
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('podcastModal'));
    modal.show();
    
    // Auto-play audio after modal shows
    setTimeout(() => {
        const audio = document.getElementById('podcastAudio');
        if (audio) {
            // Agregar event listeners para debugging
            audio.addEventListener('loadstart', () => console.log('🎵 Audio: Iniciando carga'));
            audio.addEventListener('canplay', () => console.log('✅ Audio: Listo para reproducir'));
            audio.addEventListener('error', (e) => console.error('❌ Audio Error:', e));
            
            audio.play().catch(e => console.log('⚠️ Auto-play prevented:', e));
        } else {
            console.warn('⚠️ Audio element no encontrado');
        }
    }, 500);
}

function createPodcastModal() {
    // Obtener datos del curso desde variables JavaScript
    const courseTitle = '{{ course.title|escapejs }}';
    const podcastUrl = '{{ course.podcast_audio_url|escapejs }}';
    const podcastScript = `{{ course.podcast_script|escapejs }}`;
    const courseId = '{{ course.id }}';
    
    // DEBUG: Mostrar información en consola
    console.log('🎙️ DEBUG Podcast Modal:', {
        courseTitle: courseTitle,
        podcastUrl: podcastUrl,
        hasScript: !!podcastScript,
        courseId: courseId
    });
    
    let audioPlayerHTML = '';
    if (podcastUrl && podcastUrl.trim() !== '') {
        audioPlayerHTML = `
            <div class="audio-player-container">
                <audio id="podcastAudio" controls class="w-100" preload="metadata" crossorigin="anonymous">
                    <source src="${podcastUrl}" type="audio/mpeg">
                    Tu navegador no soporta el reproductor de audio.
                </audio>
                <div class="mt-2">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Conversación entre María (voz femenina) y Carlos (voz masculina)
                    </small>
                </div>
                <div class="mt-2">
                    <small class="text-info">
                        <i class="fas fa-link me-1"></i>
                        URL: ${podcastUrl.substring(0, 60)}...
                    </small>
                </div>
            </div>
        `;
    } else {
        audioPlayerHTML = `
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                El podcast conversacional se está generando. Intenta de nuevo en unos momentos.
                <br><small class="text-muted">Estado: URL vacía o no válida</small>
            </div>
        `;
    }
    
    let transcriptHTML = '';
    if (podcastScript) {
        transcriptHTML = `
            <div class="mt-4">
                <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#modalPodcastScript">
                    <i class="fas fa-file-text me-1"></i>
                    Ver Transcripción Completa
                </button>
                <div class="collapse mt-3" id="modalPodcastScript">
                    <div class="card">
                        <div class="card-body">
                            <div style="max-height: 300px; overflow-y: auto;">
                                <pre class="mb-0" style="white-space: pre-wrap; font-family: inherit; font-size: 0.9rem;">${podcastScript}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    const modalHTML = `
        <div class="modal fade" id="podcastModal" tabindex="-1" aria-labelledby="podcastModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="podcastModalLabel">
                            <i class="fas fa-podcast me-2"></i>
                            Conversación Introductoria - ${courseTitle.substring(0, 40)}${courseTitle.length > 40 ? '...' : ''}
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-4">
                            <div class="d-inline-flex align-items-center bg-light rounded-pill px-4 py-2">
                                <div class="me-3">
                                    <i class="fas fa-user-circle fa-2x text-primary"></i>
                                    <div class="small text-muted">María</div>
                                </div>
                                <div class="mx-2">
                                    <i class="fas fa-comments text-muted"></i>
                                </div>
                                <div class="ms-3">
                                    <i class="fas fa-user-circle fa-2x text-success"></i>
                                    <div class="small text-muted">Carlos</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <p class="mb-0">
                                <strong>¡Escucha la conversación especial!</strong><br>
                                María y Carlos conversan sobre el curso, qué aprenderás 
                                y por qué es importante en menos de 1 minuto y 30 segundos.
                            </p>
                        </div>
                        
                        ${audioPlayerHTML}
                        ${transcriptHTML}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>
                            Cerrar
                        </button>
                        <a href="/course/${courseId}/module/modulo_1/" class="btn btn-success">
                            <i class="fas fa-rocket me-2"></i>
                            ¡Empezar Curso!
                        </a>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Agregar modal al body
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}
</script>
{% endblock %}

{% block extra_css %}
<style>
    /* Modern Loading Overlay Styles */
    .modern-loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.5s ease;
        overflow: hidden;
    }

    /* Animated Background Particles */
    .particles-container {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .particle {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 6s ease-in-out infinite;
    }

    .particle-1 { width: 20px; height: 20px; left: 10%; top: 20%; animation-delay: 0s; }
    .particle-2 { width: 15px; height: 15px; left: 80%; top: 10%; animation-delay: 1s; }
    .particle-3 { width: 25px; height: 25px; left: 70%; top: 80%; animation-delay: 2s; }
    .particle-4 { width: 18px; height: 18px; left: 20%; top: 70%; animation-delay: 3s; }
    .particle-5 { width: 12px; height: 12px; left: 90%; top: 60%; animation-delay: 1.5s; }
    .particle-6 { width: 22px; height: 22px; left: 5%; top: 50%; animation-delay: 4s; }
    .particle-7 { width: 16px; height: 16px; left: 60%; top: 30%; animation-delay: 2.5s; }
    .particle-8 { width: 14px; height: 14px; left: 40%; top: 90%; animation-delay: 0.5s; }

    @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.3; }
        50% { transform: translateY(-20px) rotate(180deg); opacity: 0.8; }
    }

    /* Animated Waves */
    .waves-container {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .wave {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 200%;
        height: 100px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        animation: wave 8s ease-in-out infinite;
    }

    .wave-1 { animation-delay: 0s; }
    .wave-2 { animation-delay: 2s; height: 80px; }
    .wave-3 { animation-delay: 4s; height: 60px; }

    @keyframes wave {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(50%); }
    }

    /* Main Content */
    .modern-loading-content {
        text-align: center;
        color: white;
        max-width: 800px;
        padding: 2rem;
        position: relative;
        z-index: 10;
    }

    /* AI Animation */
    .ai-animation-container {
        margin-bottom: 2rem;
    }

    .ai-core {
        position: relative;
        display: inline-block;
        width: 120px;
        height: 120px;
    }

    .core-rings {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .ring {
        position: absolute;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        animation: spin 3s linear infinite;
    }

    .ring-1 {
        width: 100%;
        height: 100%;
        animation-duration: 3s;
    }

    .ring-2 {
        width: 80%;
        height: 80%;
        top: 10%;
        left: 10%;
        animation-duration: 2s;
        animation-direction: reverse;
    }

    .ring-3 {
        width: 60%;
        height: 60%;
        top: 20%;
        left: 20%;
        animation-duration: 4s;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .ai-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
    }

    .ai-brain-svg {
        width: 100%;
        height: 100%;
        animation: pulse-brain 2s ease-in-out infinite;
    }

    @keyframes pulse-brain {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    /* Brain Learning Animations */
    .brain-main {
        animation: brain-thinking 4s ease-in-out infinite;
    }

    @keyframes brain-thinking {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.9; }
    }

    .brain-division {
        animation: division-pulse 3s ease-in-out infinite;
    }

    @keyframes division-pulse {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.7; }
    }

    .brain-fold-1 { animation: fold-wave 4s ease-in-out infinite; animation-delay: 0s; }
    .brain-fold-2 { animation: fold-wave 4s ease-in-out infinite; animation-delay: 0.5s; }
    .brain-fold-3 { animation: fold-wave 4s ease-in-out infinite; animation-delay: 1s; }
    .brain-fold-4 { animation: fold-wave 4s ease-in-out infinite; animation-delay: 1.5s; }

    @keyframes fold-wave {
        0%, 70%, 100% { opacity: 0.4; }
        35% { opacity: 0.8; }
    }

    /* Neural Network Animations */
    .neuron {
        animation: neuron-fire 3s ease-in-out infinite;
    }

    .neuron-1 { animation-delay: 0s; }
    .neuron-2 { animation-delay: 0.3s; }
    .neuron-3 { animation-delay: 0.6s; }
    .neuron-4 { animation-delay: 0.9s; }
    .neuron-5 { animation-delay: 1.2s; }
    .neuron-6 { animation-delay: 1.5s; }

    @keyframes neuron-fire {
        0%, 80%, 100% { 
            opacity: 0.6; 
            transform: scale(1); 
            filter: drop-shadow(0 0 2px #fbbf24);
        }
        40% { 
            opacity: 1; 
            transform: scale(1.3); 
            filter: drop-shadow(0 0 8px #fbbf24);
        }
    }

    /* Neural Connection Animations */
    .neural-connection {
        animation: connection-pulse 2s ease-in-out infinite;
    }

    .connection-1 { animation-delay: 0.1s; }
    .connection-2 { animation-delay: 0.3s; }
    .connection-3 { animation-delay: 0.5s; }
    .connection-4 { animation-delay: 0.7s; }
    .connection-5 { animation-delay: 0.9s; }
    .connection-6 { animation-delay: 1.1s; }

    @keyframes connection-pulse {
        0%, 70%, 100% { 
            opacity: 0.3; 
            stroke-width: 1;
        }
        35% { 
            opacity: 0.9; 
            stroke-width: 2;
            filter: drop-shadow(0 0 3px #fbbf24);
        }
    }

    /* Thought Bubble Animations */
    .thought-bubble {
        animation: bubble-float 6s ease-in-out infinite;
    }

    .bubble-1 { animation-delay: 0s; }
    .bubble-2 { animation-delay: 1.5s; }
    .bubble-3 { animation-delay: 3s; }
    .bubble-4 { animation-delay: 4.5s; }

    @keyframes bubble-float {
        0%, 100% { 
            opacity: 0.3; 
            transform: translateY(0) scale(1); 
        }
        25% { 
            opacity: 0.8; 
            transform: translateY(-5px) scale(1.2); 
        }
        50% { 
            opacity: 0.6; 
            transform: translateY(-3px) scale(1.1); 
        }
        75% { 
            opacity: 0.4; 
            transform: translateY(-2px) scale(1.05); 
        }
    }

    .processing-dots {
        position: absolute;
        bottom: -40px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
    }

    .dot {
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        animation: dot-bounce 1.4s ease-in-out infinite both;
    }

    .dot-1 { animation-delay: 0s; }
    .dot-2 { animation-delay: 0.2s; }
    .dot-3 { animation-delay: 0.4s; }

    @keyframes dot-bounce {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1); }
    }

    /* Typography */
    .modern-loading-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
        background: linear-gradient(45deg, #ffffff, #dbeafe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: title-glow 3s ease-in-out infinite;
    }

    @keyframes title-glow {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
    }

    .modern-loading-status {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 3rem;
        font-weight: 400;
    }

    /* Enhanced Progress Bar */
    .modern-progress-container {
        margin-bottom: 3rem;
        position: relative;
    }

    .progress-track {
        width: 100%;
        height: 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        overflow: hidden;
        position: relative;
        backdrop-filter: blur(10px);
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #60a5fa, #3b82f6, #1d4ed8);
        border-radius: 6px;
        width: 0%;
        transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .progress-glow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: glow-slide 2s ease-in-out infinite;
    }

    @keyframes glow-slide {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .progress-particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .particle-flow {
        position: absolute;
        width: 4px;
        height: 4px;
        background: white;
        border-radius: 50%;
        animation: particle-move 3s linear infinite;
    }

    .particle-flow-1 { top: 2px; animation-delay: 0s; }
    .particle-flow-2 { top: 4px; animation-delay: 1s; }
    .particle-flow-3 { top: 6px; animation-delay: 2s; }

    @keyframes particle-move {
        0% { left: -10px; opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { left: 100%; opacity: 0; }
    }

    .progress-percentage {
        position: absolute;
        top: -35px;
        right: 0;
        font-size: 0.9rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.8);
    }

    /* Progress Steps */
    .modern-progress-steps {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 3rem;
        gap: 2rem;
    }

    .progress-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        opacity: 0.4;
        transition: all 0.3s ease;
    }

    .progress-step.active {
        opacity: 1;
        transform: scale(1.1);
    }

    .progress-step.completed {
        opacity: 1;
    }

    .step-circle {
        position: relative;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.5rem;
        border: 2px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    .progress-step.active .step-circle {
        background: rgba(255, 255, 255, 0.2);
        border-color: white;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }

    .progress-step.completed .step-circle {
        background: #10b981;
        border-color: #10b981;
    }

    .step-number {
        font-weight: 600;
        font-size: 1rem;
        color: white;
    }

    .step-pulse {
        position: absolute;
        top: -5px;
        left: -5px;
        width: calc(100% + 10px);
        height: calc(100% + 10px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        animation: step-pulse 2s ease-in-out infinite;
        opacity: 0;
    }

    .progress-step.active .step-pulse {
        opacity: 1;
    }

    @keyframes step-pulse {
        0% { transform: scale(0.8); opacity: 1; }
        100% { transform: scale(1.2); opacity: 0; }
    }

    .step-label {
        font-size: 0.9rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
    }

    .step-connector {
        width: 60px;
        height: 2px;
        background: rgba(255, 255, 255, 0.2);
        margin: 0 -1rem;
        margin-top: -25px;
    }

    /* Learning Facts */
    .learning-facts-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
    }

    .fact-icon {
        position: absolute;
        top: 1rem;
        left: 1.5rem;
        font-size: 1.5rem;
        color: #fbbf24;
        animation: fact-glow 2s ease-in-out infinite;
    }

    @keyframes fact-glow {
        0%, 100% { opacity: 0.8; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.1); }
    }

    .rotating-facts {
        margin-left: 3rem;
        position: relative;
        min-height: 80px;
        display: flex;
        align-items: center;
    }

    .fact {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
        font-size: 1.1rem;
        line-height: 1.6;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 500;
    }

    .fact.active {
        opacity: 1;
        transform: translateY(0);
    }

    /* Dashboard Suggestion */
    .dashboard-suggestion {
        margin-top: 2rem;
    }

    .suggestion-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-size: 0.9rem;
        padding: 0.75rem 1.5rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .suggestion-link:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .modern-loading-content {
            padding: 1rem;
        }

        .modern-loading-title {
            font-size: 2rem;
        }

        .modern-progress-steps {
            gap: 1rem;
        }

        .step-connector {
            width: 40px;
        }

        .rotating-facts {
            margin-left: 2.5rem;
        }
        
        .fact {
            font-size: 1rem;
        }
    }
        color: white;
    }

    .loading-tips {
        margin-top: 2rem;
    }

    .tip-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .tip-card i {
        font-size: 1.5rem;
        color: #ffd700;
    }

    /* Success Modal Styles */
    .success-animation {
        display: flex;
        justify-content: center;
    }

    .checkmark {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: block;
        stroke-width: 4;
        stroke: #28a745;
        stroke-miterlimit: 10;
        box-shadow: inset 0px 0px 0px #28a745;
        animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        position: relative;
        margin: 0 auto;
    }

    .checkmark-stem {
        position: absolute;
        width: 3px;
        height: 30px;
        background-color: #28a745;
        left: 25px;
        top: 15px;
        transform: rotate(45deg);
        animation: checkmark-stem 0.3s ease-out 0.9s both;
    }

    .checkmark-kick {
        position: absolute;
        width: 15px;
        height: 3px;
        background-color: #28a745;
        left: 10px;
        top: 35px;
        transform: rotate(45deg);
        animation: checkmark-kick 0.3s ease-out 1.2s both;
    }

    @keyframes checkmark-stem {
        0% { height: 0; }
        100% { height: 30px; }
    }

    @keyframes checkmark-kick {
        0% { width: 0; }
        100% { width: 15px; }
    }

    @keyframes fill {
        100% { box-shadow: inset 0px 0px 0px 30px #28a745; }
    }

    @keyframes scale {
        0%, 100% { transform: none; }
        50% { transform: scale3d(1.1, 1.1, 1); }
    }

    /* Existing Styles */
    .module-card {
        transition: all 0.2s;
        background-color: #fff;
    }
    
    .module-card:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
    
    .chunk-content {
        font-size: 1.1rem;
        line-height: 1.6;
    }
    
    .status-badge {
        font-size: 0.75rem;
    }
    
    audio {
        height: 40px;
        border-radius: 8px;
    }
    
    .audio-player-container {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #e9ecef;
    }
    
    #podcastAudio {
        width: 100%;
        height: 50px;
        border-radius: 8px;
    }
    
    .modal-body .alert {
        border-radius: 10px;
    }
    
    .module-progress {
        margin-top: 8px;
    }

    /* --- Colores personalizados para highlight.js --- */
    .markdown-body .hljs-keyword,
    .markdown-body .hljs-built_in,
    .markdown-body .hljs-title { color: #15803d; }   /* verde */

    .markdown-body .hljs-string { color: #d97706; }  /* naranja */

    .markdown-body .hljs-number,
    .markdown-body .hljs-literal,
    .markdown-body .hljs-punctuation,
    .markdown-body .hljs-operator { color: #2563eb; }  /* azul */
</style>
{% endblock %} 